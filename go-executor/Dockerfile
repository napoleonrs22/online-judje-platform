# go-executor/Dockerfile

# 1. –ò—Å–ø–æ–ª—å–∑—É–µ–º Go –≤ –∫–∞—á–µ—Å—Ç–≤–µ –±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞ –¥–ª—è —Å–±–æ—Ä–∫–∏ (Builder Stage)
FROM golang:1.23-alpine AS builder 

WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º go.mod –∏ go.sum –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
COPY go.mod .
COPY go.sum .
RUN go mod download

# –ö–æ–ø–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
COPY . .

# –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
RUN go build -o /go-executor main.go

# -------------------------------------------------------------
# 2. –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è (Final Stage)
FROM alpine:latest

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º ca-certificates 
RUN apk add --no-cache ca-certificates 
# üî• –£–î–ê–õ–ï–ù–ê: —É—Å—Ç–∞–Ω–æ–≤–∫–∞ docker-cli
# üî• –£–î–ê–õ–ï–ù–ê: –∫–æ–º–∞–Ω–¥–∞ RUN docker pull...

WORKDIR /usr/bin

# –ö–æ–ø–∏—Ä—É–µ–º —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∏–Ω–∞—Ä–Ω–∏–∫
COPY --from=builder /go-executor /go-executor

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞
ENTRYPOINT ["/go-executor"]