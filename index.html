<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Judge Tester</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .container { max-width: 1000px; }
        .card-header { font-weight: bold; }
        textarea { font-family: 'Consolas', 'Courier New', monospace; }
        #log { max-height: 400px; overflow-y: scroll; background: #343a40; color: #fff; }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4 text-center">–°–µ—Ä–≤–∏—Å –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Online Judge (FastAPI + Go)</h1>
        
        <div id="log" class="p-3 mb-4 rounded">–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:</div>

        <div class="row">
            
            <div class="col-md-6 mb-4">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        1. –°–æ–∑–¥–∞—Ç—å –ó–∞–¥–∞—á—É (POST /api/teacher/problems)
                    </div>
                    <div class="card-body">
                        <form id="createProblemForm">
                            <div class="mb-3">
                                <label for="problemTitle" class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                                <input type="text" class="form-control" id="problemTitle" value="–°—É–º–º–∞ –¥–≤—É—Ö —á–∏—Å–µ–ª" required>
                            </div>
                            <div class="mb-3">
                                <label for="problemDescription" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                                <textarea class="form-control" id="problemDescription" rows="3" required>–ù–∞–ø–∏—à–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É, –∫–æ—Ç–æ—Ä–∞—è —Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–≤–∞ —Ü–µ–ª—ã—Ö —á–∏—Å–ª–∞ –∏ –≤—ã–≤–æ–¥–∏—Ç –∏—Ö —Å—É–º–º—É.</textarea>
                            </div>
                            <div class="mb-3">
                                <label for="problemDifficulty" class="form-label">–°–ª–æ–∂–Ω–æ—Å—Ç—å</label>
                                <select class="form-select" id="problemDifficulty">
                                    <option value="–õ–µ–≥–∫–∏–π">–õ–µ–≥–∫–∏–π</option>
                                    <option value="–°—Ä–µ–¥–Ω–∏–π">–°—Ä–µ–¥–Ω–∏–π</option>
                                    <option value="–°–ª–æ–∂–Ω—ã–π">–°–ª–æ–∂–Ω—ã–π</option>
                                </select>
                            </div>
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="isPublic" checked>
                                <label class="form-check-label" for="isPublic">
                                    –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É (is_public: true)
                                </label>
                            </div>

                            <h5 class="mt-4">–¢–µ—Å—Ç-–∫–µ–π—Å (–æ–¥–∏–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä)</h5>
                            <div class="mb-3">
                                <label for="testInput" class="form-label">–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</label>
                                <textarea class="form-control" id="testInput" rows="1">10 2</textarea>
                            </div>
                            <div class="mb-3">
                                <label for="testOutput" class="form-label">–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥</label>
                                <textarea class="form-control" id="testOutput" rows="1">12</textarea>
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-100">–°–æ–∑–¥–∞—Ç—å –∏ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card shadow">
                    <div class="card-header bg-success text-white">
                        2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –†–µ—à–µ–Ω–∏–µ (POST /api/student/submissions)
                    </div>
                    <div class="card-body">
                        <form id="submitSolutionForm">
                            <div class="mb-3">
                                <label for="submissionProblemId" class="form-label">ID –ó–∞–¥–∞—á–∏ (Problem ID)</label>
                                <input type="text" class="form-control" id="submissionProblemId" placeholder="–í–≤–µ–¥–∏—Ç–µ ID —Å–æ–∑–¥–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏" required>
                            </div>
                            <div class="mb-3">
                                <label for="submissionLanguage" class="form-label">–Ø–∑—ã–∫</label>
                                <select class="form-select" id="submissionLanguage">
                                    <option value="python">Python</option>
                                    <option value="java">Java</option>
                                    <option value="cpp">C++</option>
                                    <option value="javascript">JavaScript</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="submissionCode" class="form-label">–ö–æ–¥ –†–µ—à–µ–Ω–∏—è (Python)</label>
                                <textarea class="form-control" id="submissionCode" rows="10" required>import sys

# –°—á–∏—Ç—ã–≤–∞–µ–º –¥–≤–∞ —á–∏—Å–ª–∞ –∏–∑ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
try:
    data = sys.stdin.read().split()
    if len(data) >= 2:
        a = int(data[0])
        b = int(data[1])
        # –î–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –∑–∞–≥–ª—É—à–∫–∏ Go-Executor'–∞
        # –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –≤—ã–≤–µ—Å—Ç–∏ '12' –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö '10 2'
        print(a + b)
    else:
        print("–û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞")
except:
    print("–û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞/–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏")
</textarea>
                            </div>
                            <button type="submit" class="btn btn-success w-100">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ü—Ä–æ–≤–µ—Ä–∫—É</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8000';
        const logElement = document.getElementById('log');

        function log(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            let color = 'white';
            if (type === 'success') color = '#28a745'; // green
            if (type === 'error') color = '#dc3545';   // red
            if (type === 'warning') color = '#ffc107'; // yellow
            
            const p = document.createElement('p');
            p.innerHTML = `<span style="color: grey;">[${time}]</span> <span style="color: ${color};">${message}</span>`;
            logElement.prepend(p);
        }

        // --- 1. –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ ---
        document.getElementById('createProblemForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const title = document.getElementById('problemTitle').value;
            const difficulty = document.getElementById('problemDifficulty').value;
            
            const problemData = {
                title: title,
                description: document.getElementById('problemDescription').value,
                difficulty: difficulty,
                checker_type: "exact", // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ
                examples: [],
                test_cases: [
                    {
                        input_data: document.getElementById('testInput').value,
                        output_data: document.getElementById('testOutput').value,
                        is_sample: true 
                    }
                ],
                is_public: document.getElementById('isPublic').checked
            };

            log(`–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏: ${title}...`);

            try {
                const response = await fetch(`${API_BASE_URL}/api/teacher/problems`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(problemData)
                });

                const result = await response.json();

                if (response.ok) {
                    log(`‚úÖ –ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞! ID: ${result.problem_id}. SLUG: ${result.slug}`, 'success');
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º ID –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ—à–µ–Ω–∏—è
                    document.getElementById('submissionProblemId').value = result.problem_id;
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ (HTTP ${response.status}): ${result.detail || JSON.stringify(result)}`, 'error');
                }
            } catch (error) {
                log(`üî• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ${error.message}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ FastAPI –Ω–∞ ${API_BASE_URL}.`, 'error');
            }
        });


        // --- 2. –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ—à–µ–Ω–∏—è ---
        document.getElementById('submitSolutionForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const submissionProblemId = document.getElementById('submissionProblemId').value;
            const submissionLanguage = document.getElementById('submissionLanguage').value;
            
            const submissionData = {
                problem_id: submissionProblemId,
                language: submissionLanguage,
                code: document.getElementById('submissionCode').value,
            };

            log(`–û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è ID ${submissionProblemId}...`);

            try {
                const response = await fetch(`${API_BASE_URL}/api/student/submissions`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(submissionData)
                });

                const result = await response.json();

                if (response.ok) {
                    const status = result.final_status || result.status;
                    log(`üéâ –†–µ—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ. –í–µ—Ä–¥–∏–∫—Ç: ${status}. –°–æ–æ–±—â–µ–Ω–∏–µ: ${result.message}`, status === 'ACCEPTED' ? 'success' : status === 'WRONG_ANSWER' ? 'warning' : 'info');
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ—à–µ–Ω–∏—è (HTTP ${response.status}): ${result.detail || JSON.stringify(result)}`, 'error');
                }
            } catch (error) {
                log(`üî• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ${error.message}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ FastAPI –Ω–∞ ${API_BASE_URL}.`, 'error');
            }
        });
    </script>
</body>
</html>